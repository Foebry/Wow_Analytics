"""SQL database functionality"""
import mysql.connector

class SQL:
    """SQL database class"""

    def __init__(self, data):
        """SQL database constructor"""
        self.type = data['type']
        self.user = data['user']
        self.password = data['password']
        self.host = data['host']
        self.schema = data['schema']


    def connect(self):
        """SQL database connecting method"""
        connection = mysql.connector.connect(
            user=self.user,
            password=self.password,
            host=self.host,
            database=self.schema,
            buffered=True
            )
        return connection


    def get(self, query, all=False):
        """SQL database SELECT querries"""

        # Single values
        connection = self.connect()
        cursor = connection.cursor()
        cursor.execute(query)

        if all: data = cursor.fetchall()
        else: data = cursor.fetchone()

        connection.close()

        return data


    def write(self, query, logger):
        """SQL database INSERT querries"""

        connection = self.connect()
        cursor = connection.cursor()

        try:
            cursor.execute(query)
            connection.commit()
        except mysql.connector.errors.ProgrammingError as error: return self.HandleError(connection, error, query, logger)
        except mysql.connector.errors.IntegrityError as error: return self.HandleError(connection, error, query, logger)
        except mysql.connector.errors.OperationalError as error: return self.HandleError(connection, error, query, logger)

        connection.close()
        return True


    def execute(self, query):
        """SQL database other querries"""

        connection = self.connect()
        cursor = connection.cursor()

        cursor.execute(query)
        connection.commit()

        connection.close()


    def HandleError(self, connection, err, query, logger):
        logger.log(f"{err} // {query}", type(err))
        connection.close()
        return False
